<!DOCTYPE html>
<html lang="fr-FR">

  <head itemscope itemtype="http://schema.org/WebSite">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="bertrandkeller RSS Feed" href="http://bertrandkeller.info/feed/"/>

  <title>Ne plus utiliser page.config.no_cache = 1 ; préférer TCEMAIN.clearCacheCmd = all</title>
  <meta name="description" content="Pour améliorer les performances de l'affichage d'une page web sont mis en place différentes séries de cache. Il en existe deux principaux : le cache navigate...">

  <style type="text/css">
    
    /*480px */
/*768px */
/*1025px*/
/*1441px*/
/*1921px*/
@media screen and (min-width: 0) {
  head {
    font-family: "usn-small 0"; }

  body:after {
    content: "usn-small - min-width: 0"; } }
@media screen and (min-width: 48.063em) {
  head {
    font-family: "usn-medium 48.063em"; }

  body:after {
    content: "usn-medium - min-width: 48.063em"; } }
@media screen and (min-width: 64.063em) {
  head {
    font-family: "usn-large 64.063em"; }

  body:after {
    content: "usn-large - min-width: 64.063em"; } }
head {
  clear: both; }
head title {
  font-family: "usn-small 0, usn-medium 48.063em, usn-large 64.063em"; }

body:after {
  display: none; }

*[data-usn-if] {
  display: none; }

/* 1.2   */
/* 1.44  */
/* 1.728 */
/* 2.074 */
/* 2.488 */
/* 2.986 */
/* 3.583 */
body {
  font-family: Overpass, Helvetica, Arial, sans-serif;
  font-weight: 400;
  font-size: 1em;
  line-height: 1.44; }

h3, h2 {
  line-height: 1.2; }

h1 {
  line-height: 1; }

h6, .h6 {
  font-size: 0.83333em; }

h5, .h5 {
  font-size: 1em; }

h4, .h4 {
  font-size: 1.2em; }

h3, .h3 {
  font-size: 1.44em; }

h2, .h2 {
  font-size: 1.728em; }

h1, .h1 {
  font-size: 2.0736em; }

@media only screen and (min-width: 48.063em) {
  body {
    font-size: 1.2em; }

  h3 {
    font-size: 1.728em; }

  h2 {
    font-size: 2.0736em; }

  h1 {
    font-size: 2.48832em; } }
@media only screen and (min-width: 64.063em) {
  h2 {
    font-size: 2.48832em; }

  h1 {
    font-size: 2.98598em; } }
@media only screen and (min-width: 90.063em) {
  h1 {
    font-size: 3.58318em; } }
h1, .h1, h2, .h2, h3, .h3 {
  margin-top: 1em;
  margin-bottom: 0.5em; }
h1 small, h1 .small, .h1 small, .h1 .small, h2 small, h2 .small, .h2 small, .h2 .small, h3 small, h3 .small, .h3 small, .h3 .small {
  font-size: 65%; }

h4, .h4, h5, .h5, h6, .h6 {
  margin-top: 0.5em;
  margin-bottom: 0.5em; }
h4 small, h4 .small, .h4 small, .h4 .small, h5 small, h5 .small, .h5 small, .h5 .small, h6 small, h6 .small, .h6 small, .h6 .small {
  font-size: 75%; }

h1, h1 a, h2, h2 a, h3, h3 a, h4, h4 a, h5, h5 a, h6, h6 a {
  text-decoration: none; }

p {
  margin: 0 0 0.5em; }

ul, ol {
  margin-top: 0;
  margin-bottom: 0.5em; }
ul ul, ul ol, ol ul, ol ol {
  margin-bottom: 0; }

.list-unstyled, .list-inline {
  padding-left: 0;
  list-style: none; }

.list-inline {
  margin-left: -5px; }
.list-inline > li {
  display: inline-block;
  padding-left: 5px;
  padding-right: 5px; }

dl {
  margin-top: 0;
  margin-bottom: 1em; }

dt, dd {
  line-height: 1.44; }

dt {
  font-weight: bold; }

dd {
  margin-left: 0; }

html, body {
  box-sizing: border-box; }

*, *:before, *:after {
  box-sizing: inherit; }

a {
  text-decoration: underline;
  color: #111; }

/**
 * Images
 */
img {
  max-width: 100%;
  vertical-align: middle; }

/**
 * Figures
 */
figure > img {
  display: block; }

figcaption {
  font-size: 14px; }

/**
 * Links
 */
a {
  text-decoration: underline;
  color: #111; }
a:visited {
  color: #111; }
a:hover {
  text-decoration: underline;
  color: #0c0c0c; }

/**
 * Blockquotes
 */
blockquote {
  padding-left: 0.5em;
  font-size: 18px;
  font-style: italic;
  letter-spacing: -1px;
  color: #828282;
  border-left: 4px solid #e8e8e8; }
blockquote > :last-child {
  margin-bottom: 0; }

/**
 * Code formatting
 */
pre, code {
  font-size: 15px;
  border: 1px solid #e8e8e8;
  border-radius: 3px;
  background-color: #eef; }

code {
  padding: 1px 5px; }

pre {
  overflow-x: scroll;
  padding: 8px 12px; }
pre > code {
  padding-right: 0;
  padding-left: 0;
  border: 0; }

table {
  width: 100%;
  table-layout: fixed;
  border-collapse: collapse;
  border: 1px solid #ccc; }
table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td, table > tfoot > tr > th, table > tfoot > tr > td {
  border: 1px solid #ccc; }
table > thead > tr > th, table > thead > tr > td {
  border-bottom-width: 2px; }

  </style>
  <script>
    /*
loadCSS: load a CSS file asynchronously.
[c]2015 @scottjehl, Filament Group, Inc.
Licensed MIT
*/
(function(w){
  "use strict";
  /* exported loadCSS */
  w.loadCSS = function( href, before, media ){
    // Arguments explained:
    // `href` [REQUIRED] is the URL for your CSS file.
    // `before` [OPTIONAL] is the element the script should use as a reference for injecting our stylesheet <link> before
      // By default, loadCSS attempts to inject the link after the last stylesheet or script in the DOM. However, you might desire a more specific location in your document.
    // `media` [OPTIONAL] is the media type or query of the stylesheet. By default it will be 'all'
    var ss = w.document.createElement( "link" );
    var ref;
    if( before ){
      ref = before;
    }
    else if( w.document.querySelectorAll ){
      var refs = w.document.querySelectorAll(  "style,link[rel=stylesheet],script" );
      // No need to check length. This script has a parent element, at least
      ref = refs[ refs.length - 1];
    }
    else {
      ref = w.document.getElementsByTagName( "script" )[ 0 ];
    }

    var sheets = w.document.styleSheets;
    ss.rel = "stylesheet";
    ss.href = href;
    // temporarily set media to something inapplicable to ensure it'll fetch without blocking render
    ss.media = "only x";

    // Inject link
      // Note: the ternary preserves the existing behavior of "before" argument, but we could choose to change the argument to "after" in a later release and standardize on ref.nextSibling for all refs
      // Note: `insertBefore` is used instead of `appendChild`, for safety re: http://www.paulirish.com/2011/surefire-dom-element-insertion/
    ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
    // A method (exposed on return object for external use) that mimics onload by polling until document.styleSheets until it includes the new sheet.
    ss.onloadcssdefined = function( cb ){
      var defined;
      for( var i = 0; i < sheets.length; i++ ){
        if( sheets[ i ].href && sheets[ i ].href === ss.href ){
          defined = true;
        }
      }
      if( defined ){
        cb();
      } else {
        setTimeout(function() {
          ss.onloadcssdefined( cb );
        });
      }
    };

    // once loaded, set link's media back to `all` so that the stylesheet applies once it loads
    ss.onloadcssdefined(function() {
      ss.media = media || "all";
    });
    return ss;
  };
}(this));

    loadCSS("/assets/css/style.css");
    !function(){"use strict";function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(e){return window.localStorage&&localStorage.font_css_cache&&localStorage.font_css_cache_file===e}function n(){if(window.localStorage&&window.XMLHttpRequest)if(t(o))c(localStorage.font_css_cache);else{var n=new XMLHttpRequest;n.open("GET",o,!0),e(n,"load",function(){4===n.readyState&&(c(n.responseText),localStorage.font_css_cache=n.responseText,localStorage.font_css_cache_file=o)}),n.send()}else{var a=document.createElement("link");a.href=o,a.rel="stylesheet",a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a),document.cookie="font_css_cache"}}function c(e){var t=document.createElement("style");t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)}var o="/assets/css/font.css";window.localStorage&&localStorage.font_css_cache||document.cookie.indexOf("font_css_cache")>-1?n():e(window,"load",n)}();

  </script>
  <noscript><link rel="stylesheet" href="/assets/css/style.css"></noscript>
  <noscript><link rel="stylesheet" href="/assets/css/font.css"></noscript>

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/assets/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/assets/favicons/manifest.json">
<link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#000">
<meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#000">




</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <div class="site-logo">
      <a class="site-title" href="/">bertrandkeller</a>
    </div>

    <nav class="nav-main">
      <ul>
        
          
        
          
        
          
          <li><a class="page-link" href="/archives">Archives</a></li>
          
        
          
        
          
        
          
        
          
          <li><a class="page-link" href="/son-oeuvre">Son œuvre</a></li>
          
        
          
        
      </ul>
    </nav>

  </div>

</header>


    <div class="page">
      <div class="wrapper">
        <article class="post">
  <h1 class="post-title">Ne plus utiliser page.config.no_cache = 1 ; préférer TCEMAIN.clearCacheCmd = all</h1>
  <p class="post-meta">29/07/2008</p>
  <p>Pour améliorer les performances de l'affichage d'une page web sont mis en place différentes séries de cache. Il en existe deux principaux : le cache navigateur et le cache du CMS (ici TYPO3).</p>
<h3>Le cache navigateur</h3>
<p>Lors du chargement d'une page HTML, le navigateur va lire le code et télécharger tous les éléments compris dans la page. Le temps d'affichage dépendra du temps de chargement de tous les éléments : images, feuilles de style CSS, javascripts... Vous êtes en train de lire des fichiers qui se trouvent sur un serveur distant avec une bande passante assez faible. Le cache navigateur permet de sauvegarder la page et ses éléments sur votre disque dur ; ainsi au deuxième affichage d'une page, les éléments ne sont plus lus sur un serveur distant mais sur votre propre disque dur, sans souci de bande passante. Oui, c'est plus rapide, mais ça mange un peu d'espace disque ; au prix actuel de l'octet, c'est pas vraiment gênant.</p>
<p>Dans le milieu du web, lors de la conception d'une page ou lors d'une modification, nous sommes amenés à modifier des images, des feuilles de styles et même du javascript. Mais alors si ces éléments sont lus sur le disque, leur modification sur le serveur distant ne seront jamais visibles. A cela, je réponds le phrase préférée du développeur : "vide ton cache".<br />
 Dans le langage du développeur web "vide ton cache navigateur" consiste à appuyer simultanément sur les touches "ctrl+F5" ou encore "ctrl+R" (ça marche sur tous les navigateurs et c'est à faire absolument avant d'appeler son développeur préféré). Le navigateur va effacer les éléments conservés sur le disque dur et les remplacer par les nouveaux.</p>
<h3>Le cache TYPO3</h3>
<p>Quand vous visitez un site créé à partir du CMS TYPO3 (c'est un exemple) ; les pages sont dynamiques, générées en fonction de différents paramètres : le contenu, l'ouverture du menu, les extensions présentes, activation de session... Si beaucoup d'éléments de contenu sont présents sur la page, la génération de la page peut être très longue (fonction du nombre de requête en base de données) ; encore plus longue si beaucoup d'utilisateurs essayent d'y accéder en même temps. TYPO3 possède donc son propre système de cache pour sauvegarder les pages, mais cette fois-ci du côté serveur.<br /> Il les sauvegarde au format HTML.</p>
<p>Dans le milieu du web (je pense que vous avez devinez que c'était mon métier), avoir des pages cachées en HTML par le CMS, c'est bien pour un site en production, mais c'est pas pratique parce que ça empêche de voir les modifications durant le développement. Alors lorsque quelqu'un s'échine sur sa page en appuyant sur "ctrl+F5" à plusieurs reprises en disant tout haut "je ne comprends pas ça devrait marcher", je lui réponds "vide ton cache... TYPO3"</p>
<h3>no_cache vs TCEMAIN.clearCacheCmd</h3>
<p>Donc le métier du développeur sur TYPO3 consiste à appuyer des centaines de fois par jour sur "ctrl+F5" et à aller dans TYPO3 et vider les caches à l'aide de la souris. Comme ça use énormément les articulations, les concepteurs de TYPO3 ont pensé à une variable à configurer et qui est : <strong>page.config.no_cache = 1</strong>. Cette configuration marche plus ou moins, ça n'empêche pas d'aller vider son cache de assez souvent pour effacer les caches des gabarits HTML. Elle reste pratique en période de développement, mais il ne faut surtout pas oublier de la passer à zéro (<strong>page.config.no_cache = 0</strong>) une fois en production sinon les pages ne seront pas cachées (et le moteur de recherche ne marchera pas).</p>
<p>Ron Hall from Dallas, Texas, vous propose de ne plus utiliser no_cache et de privilégier TCEMAIN.clearCacheCmd.<br />
 TCEMAIN.clearCacheCmd, elle dit pas, tu me caches ou tu me caches pas la page ; elle dit, tu m'effaces le cache sur les id de page que je te donne chaque fois qu'un élément est édité .</p>
<p>D'habitude, on utilise cette ligne de code avec différents id de pages : pour une page d'actualités en LIST (45), une en LATEST (53) et une autre en SINGLE (60). Grâce à l'appel de cette ligne <strong>TCEMAIN.clearCacheCmd = 45,53,60</strong> dans le TS config du répertoire de stockage des actualités, les caches des pages 45,53,60 sont effacés à chaque modification d'un élément de contenu.</p>
<p>Ron utilise lui ce qu'on peut appeler la méthode américaine. Il crée un répertoire de stockage général qu'il appelle "site ressources" ; comme la fonction est récursive, à l'intérieur il place tous les répertoires de stockage (sous répertoires de "site ressources" donc) du site : TemplaVoilà, TypoScript, actualités... Dans le TS config du répertoire "site ressources", il indique la ligne <strong>TCEMAIN.clearCacheCmd = all</strong> : à chaque modification d'un élément de contenu lié à une extension, TYPO3 efface le cache de toutes les pages.</p>
<p>Dans son message <a href="http://buzz.typo3.org/people/ron-hall/article/dont-wear-out-the-clear-cache-button/">Don't Wear Out the Clear Cache Button</a>, Ron Hall nous annonce une réduction de l'effacement du cache de 95%. Lisez bien les commentaires de ce message, on y annonce que no_cache va devenir obsolète et que, bien entendu, la configuration "all" n'est pas à laisser sur un site en production.</p>

</article>

<div class="pagination">
  
  <div class="left">
    <a class="pagination-item" href="/2008/07/28/nouveau-site-de-la-sacd-sur-typo3">
      Nouveau site de la SACD sur TYPO3
    </a>
  </div>
  

  

  
  <div class="right">
    <a class="pagination-item" href="/2008/07/30/design-coding">
      Design coding
    </a>
  </div>
  

  
</div>



      </div>
    </div>
    <script src="/assets/js/upup.sw.min.js" data-no-instant></script>
    <script src="/assets/js/instantclick.min.js" data-no-instant></script>
    <script data-no-instant>
      InstantClick.init();
      UpUp.start({
            'content-url': '20080729ne-plus-utiliser-no_cache-1-preferer-tcemainclearcachecmd-all',
            'assets':
              ['/assets/css/style.css',]
          });
    </script>
</script>
  </body>

</html>

